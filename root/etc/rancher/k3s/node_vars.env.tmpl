# Node configuration variables for {{ .hostname }}
# Generated by chezmoi from nodes configuration

# Node identification
HOSTNAME="{{ .hostname }}"
NODE_IP="{{ (index .nodes .hostname).ip }}"
NODE_TYPE="{{ (index .nodes .hostname).node_type | default "unknown" }}"

# Node role flags
IS_SERVER={{ if eq ((index .nodes .hostname).node_type | default "unknown") "server" }}true{{ else }}false{{ end }}
IS_AGENT={{ if eq ((index .nodes .hostname).node_type | default "unknown") "agent" }}true{{ else }}false{{ end }}
IS_BOOTSTRAP={{ if (index .nodes .hostname).bootstrap | default false }}true{{ else }}false{{ end }}

{{- if eq ((index .nodes .hostname).node_type | default "unknown") "server" }}
# Server-specific configuration
ROUTER_ID="{{ (index .nodes .hostname).router_id }}"
PRIORITY="{{ (index .nodes .hostname).priority }}"
KEEPALIVED_STATE="{{ (index .nodes .hostname).keepalived_state | default "BACKUP" }}"
{{- end }}

# Network configuration
VIRTUAL_IP="{{ .network.virtual_ip }}"
GATEWAY="{{ .network.gateway }}"
DNS="{{ .network.dns }}"
SUBNET_MASK="{{ .network.subnet_mask }}"

# K3s configuration
K3S_VERSION="{{ .k3s.version }}"
CLUSTER_CIDR="{{ .k3s.cluster_cidr }}"
SERVICE_CIDR="{{ .k3s.service_cidr }}"
CLUSTER_DNS="{{ .k3s.cluster_dns }}"
CLUSTER_NAME="{{ .cluster_name }}"

# HA configuration
{{- if eq ((index .nodes .hostname).node_type | default "unknown") "server" }}
HA_ENABLED=true
HA_VIRTUAL_IP="{{ .ha.virtual_ip }}"
HA_INTERFACE="{{ .ha.interface }}"
HA_ROUTER_ID="{{ .ha.router_id }}"
{{- else }}
HA_ENABLED=false
{{- end }}